{% extends "base.html" %}

{% block title %}Departments | Employee Skills Tracker{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/department_list.css') }}">
{% endblock %}

{% block content %}
{% include '_flash_messages.html' %}
<div class="department-list-page">
<h1>All Departments</h1>

<div class="department-list">
  {% for dept in departments %}
    <section class="department-card">
      <h2>
        <a href="{{ url_for('department_detail', department_id=dept.department_id) }}">
          {{ dept.department_name }}
        </a>
      </h2>
      <p class="employee-count">
        {{ all_employees|selectattr('department_id', 'equalto', dept.department_id)|list|length }} employees
      </p>
      <div class="sample-employees">
        {% for emp in all_employees|selectattr('department_id', 'equalto', dept.department_id)|batch(3)|first %}
          <span>{{ emp.name }}</span>{% if not loop.last %}, {% endif %}
        {% endfor %}
        {% if (all_employees|selectattr('department_id', 'equalto', dept.department_id)|list|length) > 3 %}...{% endif %}
      </div>
      <div class="department-actions" style="margin-top: 18px; display: flex; gap: 10px;">
        {% if session.permissions and 'edit_department' in session.permissions %}
        <a href="{{ url_for('edit_department', department_id=dept.department_id) }}" class="btn btn-secondary">Edit</a>
        {% endif %}
        {% if session.permissions and 'delete_department' in session.permissions %}
        <form method="POST" action="{{ url_for('delete_department', department_id=dept.department_id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this department?');">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
        {% endif %}
      </div>
    </section>
  {% endfor %}
</div>
<div class="boutton-container">
  {% if session.permissions and 'add_department' in session.permissions %}
  <a href="{{ url_for('add_department') }}" class="btn">+ Add Department</a>
  {% endif %}
</div>
</div>
{% endblock %}