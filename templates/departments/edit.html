{% extends "base.html" %}

{% block title %}Edit Department | Employee Skills Tracker{% endblock %}

{% block head %}
    {{ super() }}
    <style>
      /* Department Form Styles */
      .department-form-container {
          background: #fff;
          border: 1px solid #e0e0e0;
          border-radius: 14px;
          box-shadow: 0 4px 24px rgba(56, 178, 172, 0.10);
          padding: 36px 28px 28px 28px;
          max-width: 520px;
          margin: 48px auto 0 auto;
      }
      .department-form-container h1 {
          color: #319795;
          font-size: 1.7rem;
          font-weight: 800;
          margin-bottom: 22px;
          letter-spacing: 0.01em;
          text-align: center;
      }
      .department-form-container .form-group {
          margin-bottom: 18px;
      }
      .department-form-container label {
          color: #285e61;
          font-weight: 600;
          margin-bottom: 6px;
          display: block;
      }
      .department-form-container input[type="text"],
      .department-form-container select {
          border: 1px solid #bfc9d1;
          border-radius: 8px;
          background: #f7fafc;
          color: #222;
          font-size: 15px;
          padding: 10px 12px;
          margin-bottom: 0;
          box-shadow: none;
          transition: border-color 0.2s, box-shadow 0.2s;
          width: 100%;
      }
      .department-form-container input:focus,
      .department-form-container select:focus {
          border-color: #38b2ac;
          outline: none;
          background: #fff;
          box-shadow: 0 0 0 2px #e6fffa;
      }
      .department-form-container .form-actions {
          display: flex;
          gap: 14px;
          margin-top: 24px;
          justify-content: flex-end;
      }
      .department-form-container .btn {
          background: #38b2ac;
          color: #fff;
          border: none;
          border-radius: 8px;
          font-weight: 700;
          padding: 10px 22px;
          font-size: 1rem;
          transition: background 0.2s, color 0.2s, box-shadow 0.2s;
          box-shadow: 0 2px 8px rgba(56, 178, 172, 0.10);
      }
      .department-form-container .btn:hover {
          background: #285e61;
          color: #fff;
          box-shadow: 0 4px 16px rgba(56, 178, 172, 0.18);
      }
      .department-form-container .btn-secondary {
          background: #fff;
          color: #319795;
          border: 1.5px solid #38b2ac;
      }
      .department-form-container .btn-secondary:hover {
          background: #e6fffa;
          color: #285e61;
      }
    </style>
{% endblock %}

{% block content %}
<div class="department-form-container">
  <h1>Edit Department</h1>
  <form method="POST">
      <div class="form-group">
          <label for="department_name">Department Name</label>
          <input type="text" id="department_name" name="department_name" 
                 value="{{ department.department_name }}" required>
      </div>

      <div class="form-group">
          <label for="director_emp_id">Director (Employee)</label>
          <input list="directors" id="director_emp_id_input" name="director_emp_id"
                 value="{{ department.director_emp_id or '' }}">
          <datalist id="directors">
              {% for emp in employees %}
                  <option value="{{ emp.emp_id }}">{{ emp.english_name }}</option>
              {% endfor %}
          </datalist>
      </div>

      <div class="form-group">
          <label for="parent_department_id">Parent Department</label>
          <input list="departments_list" id="parent_department_id_input" name="parent_department_id"
                 value="{{ department.parent_department_id or '' }}">
          <datalist id="departments_list">
              {% for dept in departments %}
                  {% if dept.department_id != department.department_id %}
                      <option value="{{ dept.department_id }}">{{ dept.department_name }}</option>
                  {% endif %}
              {% endfor %}
          </datalist>
      </div>

      <div class="form-actions">
          <button type="submit" class="btn">Save Changes</button>
          <a href="{{ url_for('list_departments') }}" class="btn btn-secondary">Cancel</a>
      </div>
  </form>
</div>

<script>
  // Enhance datalist inputs: show names but submit IDs
  function bindDatalist(inputId, datalistId) {
      const input = document.getElementById(inputId);
      const datalist = document.getElementById(datalistId);

      input.addEventListener("change", function () {
          const selected = Array.from(datalist.options).find(opt => opt.value === input.value);
          if (selected) {
              input.value = selected.value; // keeps the ID
          }
      });
  }

  bindDatalist("director_emp_id_input", "directors");
  bindDatalist("parent_department_id_input", "departments_list");
</script>
{% endblock %}
